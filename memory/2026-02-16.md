# 2026-02-16

## PHD — ejecución del plan (PR1 / P0)

- A partir del plan UI PHD (editorial tipo StudioDADO), se arrancó la Fase 0.
- Fix hydration error por markup inválido: `SwissTextReveal` se estaba renderizando como `<div>` dentro de `<h1>`/`<p>`.
  - Cambios: `SwissTextReveal` ahora default `as="span"` y en `HeroSection` se forzó `as="span"` en los reveals de `h1` y `p`.
- Accesibilidad/focus visible:
  - `BlogCard` tenía `focus-visible:outline-none` sin ring/outline; se cambió a outline visible (`outline-2` + `outline-offset` + `outline-accent`).
- Limpieza de lint/perf:
  - `useReducedMotion` dejó de hacer `setState` sincrónico dentro de `useEffect` (init en `useState(() => matchMedia...)`, luego solo listener).
  - `ContactTerminal`: `started` pasó a ref (`startedRef`) para analytics (evita `setState` dentro de effect en success reset).
  - `SwissTextReveal`: se eliminó el patrón de resetear refs durante render; ahora selecciona targets con `querySelectorAll([data-swiss-reveal])`.
- `pnpm lint` queda en warnings (exit 0), sin errors.
- Preferencia nueva: notificar por Telegram cada paso importante que se haga durante el trabajo (DM chatId: 574707975).

Archivos tocados clave: 
- `/Users/hector/Projects/PHD/components/ui/swiss-text-reveal.tsx`
- `/Users/hector/Projects/PHD/components/home/hero-section.tsx`
- `/Users/hector/Projects/PHD/components/blog/blog-card.tsx`
- `/Users/hector/Projects/PHD/lib/hooks/use-reduced-motion.ts`
- `/Users/hector/Projects/PHD/components/home/contact-terminal.tsx`

## Extra (stability / hygiene)
- Se agregó `actions/contact.ts` (server action de validación) porque `ContactTerminal` ya lo importaba.
- Se corrigió TypeScript/a11y en `ContactTerminal`: tipado `ContactFormState` + `aria-invalid` boolean.
- Se eliminó warning de lint en `lib/gsap/use-text-reveal.ts`.
- Se ignoró `/.claude/skills/dist/` en `.gitignore`.
- Se guardaron cambios “luxury UI experiments” en branch `wip/luxury-experiments` para no ensuciar `main`.
- Se inició PR2/Fase 1 (tokens/typography) en branch `phd/pr2-editorial-tokens`:
  - Tokens: fonts via `--font-archivo` / `--font-plex-mono`, motion tokens (dur/ease) y shadow tokens.
  - Aplicación: CTA primary + micro-interactions + transiciones globales.
  - Verificación: `pnpm lint` y `pnpm build` OK.

## Fix: ImageGridStrip black window (commit fbd949f)

**Issue**: Usuario reportó bloque negro grande entre hero y ledger sections.
- **Causa**: `ImageGridStrip` aplicaba `clip-path: inset(100% 0 0 0)` al `<section>` completo via GSAP.
- **Problema**: Mientras la animación no disparaba (antes de scroll), la sección quedaba totalmente clipped, mostrando el hero oscuro detrás (sticky + opacity-32).
- **Solución**: Aplicar clip-path a un wrapper interno (`revealRef`) en lugar del `<section>`.
  - La sección ahora tiene `bg-canvas` (warm cream) siempre visible.
  - El wrapper interno (imagen + overlays) se anima con clip-path cuando hace scroll.
  - Resultado: No más "ventana negra" mientras espera el trigger.
- **Archivos**: `/Users/hector/Projects/PHD/components/home/image-grid-strip.tsx`
- **Commit**: `fbd949f` — pushed to `phd/pr2-editorial-tokens`

## Performance pass (plan inicial) — commit e3806a4

- Objetivo: cerrar pendientes de performance del plan inicial.
- Cambios aplicados:
  1. **Menos overhead de Framer en componentes GSAP/UI**
     - Se reemplazó `useReducedMotion` de `framer-motion` por hook local `@/lib/hooks/use-reduced-motion` en:
       - `components/home/hero-section.tsx`
       - `components/home/featured-projects-grid.tsx`
       - `components/ui/swiss-card.tsx`
       - `components/ui/3d-card.tsx`
       - `components/ui/preloader.tsx`
       - `components/ui/project-gallery.tsx`
  2. **Hero image responsive tuning**
     - `sizes` actualizado a `(max-width: 1536px) 100vw, 1536px` para evitar descargas excesivas en ultra-wide.
  3. **Below-the-fold rendering optimization**
     - Nueva utilidad `.content-auto` en `app/globals.css`:
       - `content-visibility: auto`
       - `contain-intrinsic-size: 1px 900px`
     - Aplicado en `app/page.tsx` envolviendo secciones below-fold (desde Featured Projects hasta Contact).
- Verificación: `pnpm lint` + `pnpm build` OK.
- Branch: `phd/pr2-editorial-tokens`.

## QA móvil (360x740 + 390x844) — commit d4885e4

- Se ejecutó QA en Home con viewport móvil real (browser resize), validando:
  - navegación móvil (menu modal, links visibles, cierre correcto),
  - carrusel de featured (next/dots cambian slide),
  - formulario de contacto (tipos/autocomplete/hit targets),
  - overflow horizontal y hit areas.
- Hallazgo crítico:
  - **Overflow horizontal** en móvil (`overflowX ~27-29px`) causado por `ImageGridStrip` con imagen escalada (`scale: 1.15`) desbordando contenedor.
- Fix aplicado:
  - `components/home/image-grid-strip.tsx` → `section` con `overflow-hidden`.
  - Resultado: `overflowX = 0` en 360 y 390.
- Ajuste adicional de touch target:
  - `components/home/testimonials-section.tsx` → link "View all reviews" como `inline-flex min-h-11`.
- Verificación final: `pnpm lint` + `pnpm build` OK.

## Pass estricto touch targets (44x44px) — commit c2f98b5

- Petición de Hector: endurecer targets táctiles en mobile.
- Cambios aplicados (12 archivos):
  - `CtaLink` base a `min-h/min-w: 44px` reales.
  - Controles de carrusel (`prev/next/dots`) a 44px.
  - Botones de navegación en Blueprint a 44px.
  - Menú móvil (open/close/expand) y links hijos con 44px.
  - Links clave de footer + DFW section con targets mínimos móviles.
  - Botón floating back-to-top a 44px.
- Verificación QA (390x844):
  - elementos interactivos <44x44: **0** (excepto skip-link accesible oculto),
  - overflow horizontal: **0**.
- Validación técnica: `pnpm lint` + `pnpm build` OK.

## Tipografía A/B (Archivo vs Manrope vs Plus Jakarta) — commit 12c03aa

- Se implementó switch A/B/C sin romper layout:
  - `archivo` (base actual)
  - `manrope`
  - `jakarta` (Plus Jakarta Sans)
- Implementación:
  - `app/layout.tsx` carga las 3 familias via `next/font/google`.
  - Script inline lee `?font=archivo|manrope|jakarta`, guarda en `localStorage` (`phd_font_variant`) y aplica `data-font-variant` en `<html>`.
  - `app/globals.css` overridea `--font-archivo` según variante seleccionada (manteniendo sistema tokenizado existente).
- Uso rápido para QA visual:
  - `/?font=archivo`
  - `/?font=manrope`
  - `/?font=jakarta`
- Validación: `pnpm lint` + `pnpm build` OK.

## QTS-ARCHITECT — SHORT real implementado (commit 17b9957)

- Se completó soporte de short selling end-to-end con routing por intención.
- Cambios clave:
  - Enums nuevos: `AccountMode` (`spot/margin/perp`) y `OrderIntent` (`OPEN_LONG`, `OPEN_SHORT`, `CLOSE_LONG`, `CLOSE_SHORT`).
  - `Order` y `OrderRequest` ahora incluyen `intent` y `reduce_only`.
  - OMS: `process_decision()` refactorizado por `intent` (LONG/SHORT/EXIT bidireccional).
  - Apertura SHORT con colateral (`short_leverage`) y rechazo explícito en `spot`.
  - Settlement/revert/cancel/reconcile migrados de lógica por `side` a lógica por `intent`.
  - EMS/CCXT: payload normalizado con `reduceOnly` en margin/perp cuando aplica.
  - Backtest: `EXIT` ahora cierra long con sell y short con buy-to-cover.
- Config agregada:
  - `conf/live.yaml`: `oms.account_mode`, `oms.short_leverage`.
  - `conf/gateway/ccxt.yaml`: `account_mode`.
- Validación ejecutada:
  - `python3 -m py_compile` en módulos OMS/EMS/main_live/backtest/tests modificados (OK).

### Pendiente para continuar

1. Correr `pytest` completo cuando haya entorno disponible.
2. Smoke test en paper trading:
   - OPEN_LONG / OPEN_SHORT / CLOSE_LONG / CLOSE_SHORT,
   - partial fills + timeout + reconcile,
   - verificación de `reduceOnly` en exchange real.
3. Validar compatibilidad exchange-specific de params margin/perp (CCXT).
4. Hardening próximo: borrow/funding costs, límites de exposición short y guardas de liquidación.
5. Documentar runbook operativo + rollback para live.

## PHD — cierre Bloque 3 a11y Home (commit e6282c0)

- Se eliminaron dos fuentes de ruido de contraste (texto decorativo no funcional) en Home:
  - `components/home/hero-section.tsx`
    - Reemplazo de watermark textual overscroll por rails/líneas decorativas (`aria-hidden`).
  - `components/home/why-choose-us-section.tsx`
    - Reemplazo de marquee textual por bloques/rails no textuales (`aria-hidden`).
- Validación técnica:
  - `pnpm lint` ✅
  - `pnpm build` ✅
- Lighthouse posterior: accesibilidad Home ya en **100** (junto con `/projects`, `/contact`, `/services` en 100).
- QA teclado rápida:
  - Desktop: orden inicial de tab correcto (skip link → nav → CTA).
  - Mobile: menú abre como `dialog` con controles de cierre/links detectables por árbol ARIA.
